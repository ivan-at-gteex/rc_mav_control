package main

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

var ZeroValueSet = []string{
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
	"*1994|2133|2155|2130|0000000000*",
}

func setZero(t *testing.T, c *Control) {

	for _, v := range ZeroValueSet {
		err := c.ParseRaw(v)
		assert.NoError(t, err)
	}
}

func TestParse(t *testing.T) {

	var c Control
	var err error
	c.Init()

	err = c.ParseRaw("*1994|2133|2155|2130|0000000000*")
	assert.NoError(t, err)

	assert.Equal(t, int16(1994), c.Joystick[0].X.Get())
	assert.Equal(t, int16(2133), c.Joystick[0].Y.Get())
	assert.Equal(t, int16(2155), c.Joystick[1].Y.Get())
	assert.Equal(t, int16(2130), c.Joystick[1].X.Get())

	assert.False(t, c.IsButtonPressed(0))
	assert.False(t, c.IsButtonPressed(1))
	assert.False(t, c.IsButtonPressed(2))
	assert.False(t, c.IsButtonPressed(3))
	assert.False(t, c.IsButtonPressed(4))
	assert.False(t, c.IsButtonPressed(5))
	assert.False(t, c.IsButtonPressed(6))
	assert.False(t, c.IsButtonPressed(7))
	assert.False(t, c.IsButtonPressed(8))
	assert.False(t, c.IsButtonPressed(9))

	err = c.ParseRaw("*1sdfs3456|34|234*")
	assert.Error(t, err)

	err = c.ParseRaw("*3456|34|234*")
	assert.Error(t, err)

}

func TestControl(t *testing.T) {

	var c Control
	c.Init()

	setZero(t, &c)

	err := c.ParseRaw("*1994|2133|2155|2130|0000000000*")
	assert.NoError(t, err)
	assert.Equal(t, int16(0), c.Joystick[0].Y.GetScaled())
}
