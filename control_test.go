package main

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

var ZeroValueSet = []string{
	"*1976|2003|2003|1977*",
	"*1975|2005|2004|1974*",
	"*1979|1999|2001|1979*",
	"*1977|2004|2002|1977*",
	"*1974|2006|2005|1976*",
	"*1980|2002|2003|1980*",
	"*1975|2001|2000|1976*",
	"*1978|2003|2004|1979*",
	"*1976|2006|2002|1978*",
	"*1973|2002|2005|1975*",
	"*1981|2005|2003|1981*",
	"*1972|2003|2001|1974*",
	"*1977|2000|2004|1977*",
	"*1978|2005|2005|1979*",
	"*1974|2001|2002|1975*",
	"*1976|2004|2003|1976*",
	"*1979|2003|2002|1978*",
	"*1975|2007|2006|1975*",
	"*1980|2000|1999|1979*",
	"*1970|2004|2003|1973*",
	"*1982|2006|2005|1982*",
	"*1970|2000|2001|1972*",
	"*1983|2007|2006|1983*",
	"*1969|1999|2000|1971*",
	"*1984|2008|2007|1984*",
	"*1968|1998|1999|1970*",
	"*1985|2009|2008|1985*",
	"*1967|1997|1998|1969*",
	"*1986|2010|2009|1986*",
	"*1966|1996|1997|1968*",
	"*1976|2005|2006|1978*",
	"*1977|2003|2005|1978*",
	"*1978|2004|2003|1979*",
	"*1979|2005|2004|1980*",
	"*1980|2006|2005|1981*",
	"*1981|2007|2006|1982*",
	"*1982|2008|2007|1983*",
	"*1983|2009|2008|1984*",
	"*1984|2010|2009|1985*",
	"*1985|2011|2010|1986*",
	"*1975|2004|2004|1977*",
	"*1974|2003|2003|1976*",
	"*1973|2002|2002|1975*",
	"*1972|2001|2001|1974*",
	"*1971|2000|2000|1973*",
	"*1976|2003|2003|1978*",
	"*1976|2003|2004|1977*",
	"*1976|2004|2003|1977*",
	"*1977|2003|2003|1977*",
	"*1975|2003|2003|1977*",
	"*1978|2001|2005|1974*",
	"*1974|2005|2001|1980*",
	"*1979|2002|2004|1970*",
	"*1973|2004|2002|1982*",
	"*1980|2003|2003|1973*",
	"*1972|2003|2003|1981*",
	"*1981|2001|2005|1969*",
	"*1969|2005|2001|1983*",
	"*1982|2002|2004|1968*",
	"*1968|2004|2002|1984*",
	"*1977|2005|2002|1970*",
	"*1971|2004|2006|1978*",
	"*1978|2002|2001|1980*",
	"*1980|2005|2007|1976*",
	"*1974|2002|2000|1973*",
	"*1973|2006|2004|1979*",
	"*1976|2003|2003|1977*",
	"*1976|2003|2003|1977*",
	"*1977|2004|2004|1978*",
	"*1975|2002|2002|1976*",
	"*1976|2003|2003|1977*",
	"*1979|2006|2006|1980*",
	"*1972|2000|2000|1973*",
	"*1980|2007|2007|1981*",
	"*1971|1999|1999|1972*",
	"*1981|2008|2008|1982*",
	"*1970|1998|1998|1971*",
	"*1982|2009|2009|1983*",
	"*1969|1997|1997|1970*",
	"*1983|2010|2010|1984*",
	"*1976|2003|2001|1976*",
	"*1977|2002|2003|1978*",
	"*1975|2004|2005|1975*",
	"*1978|2001|2002|1979*",
	"*1974|2006|2005|1976*",
	"*1979|2000|1999|1978*",
	"*1976|2003|2003|1977*",
	"*1976|2003|2003|1977*",
	"*1977|2003|2002|1977*",
	"*1975|2003|2004|1976*",
	"*1978|2004|2006|1980*",
	"*1973|2002|2001|1972*",
	"*1979|2005|2003|1981*",
	"*1972|2004|2006|1974*",
	"*1980|2001|2002|1979*",
	"*1971|2005|2004|1973*",
	"*1976|2003|2003|1977*",
	"*1976|2003|2003|1977*",
	"*1976|2003|2003|1977*",
	"*1976|2003|2003|1977*",
	"*1976|200asdas|2003|sdfs7*",
}

func setZero(t *testing.T, c *Control) {

	for _, v := range ZeroValueSet {
		err := c.ParseRaw([]byte(v))
		assert.NoError(t, err)
	}
}

func TestParse(t *testing.T) {

	var c Control
	var err error
	c.Init()

	err = c.ParseRaw([]byte("*1234|3456|34|234*"))
	assert.NoError(t, err)

	assert.Equal(t, int16(1234), c.Joystick[0].X.Get())
	assert.Equal(t, int16(3456), c.Joystick[0].Y.Get())
	assert.Equal(t, int16(34), c.Joystick[1].Y.Get())
	assert.Equal(t, int16(234), c.Joystick[1].X.Get())

	err = c.ParseRaw([]byte("*1sdfs3456|34|234*"))
	assert.Error(t, err)

	err = c.ParseRaw([]byte("*3456|34|234*"))
	assert.Error(t, err)

}

func TestControl(t *testing.T) {

	var c Control
	c.Init()

	setZero(t, &c)

	err := c.ParseRaw([]byte("*1234|3456|34|234*"))
	assert.NoError(t, err)
	assert.Equal(t, 1234, c.Joystick[0].X.GetScaled())
}
